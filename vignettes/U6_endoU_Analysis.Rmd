---
title: "Analysis of U6 23-cyclic phosphate Capture"
author: "Rachel Ancar"
date: "04/28/2018"
output: 
  html_document:
    code_folding: hide
    toc: yes
    toc_float: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
```

This analysis was performed to assess capture of 2´,3´-cyclic phosphate capture of U6 RNA, which has a cyclic phosphate at its 3´-end produced during RNA processing. All samples should have capture of 2,´3´-cyclic phosphates at the very 3´-end of the RNA. 

```{r, message = F, warning = F}

#Load Libraries

library(tidyverse)
library(readr)
library(dplyr)
library(ggplot2)
library(stringr)
library(cowplot)
library(RColorBrewer)
library(purrr)

```

#Generating U6 coverage graphs for all cell types by viral infection status

```{r, message = F, warning = F}

#Read in bedgraph files

data_dir = "~/Dropbox (Hesselberth Lab)/Rachel_data/EndoU_project/U6_bg/"
data_files = list.files(data_dir, full.names = T)

read_file <- function(x) {
  df <- readr::read_tsv(x, col_names = c("chrom", "start", "end", "count", "normalized_count"))
  df$name <- basename(x)
  df
}

#Generate data table and make graphs

U6_table <- purrr::map_df(data_files, read_file) %>%
  dplyr::mutate(name = str_replace(name, ".U6.bg", "")) %>%
  separate(name, into = c('cell', 'virus', 'time'), sep = '_')

U6_plot <- U6_table %>%
  filter(cell == "B6") %>%
  filter(time != "012" & time != "09") %>%
  ggplot(aes(x = start, y = normalized_count, fill = time)) +
    geom_bar(stat = "identity", position = 'dodge') +
    scale_fill_brewer(palette="Set1") + 
    theme_cowplot() + 
    facet_grid(virus ~ cell) +
    theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
    labs(x="Position", y="Normalized counts") +
    #scale_x_continuous(breaks=seq(0, 30000, 5000)) + 
    ggtitle("U6 coverage plot")
U6_plot

ggsave(filename="U6.coverage.pdf", plot=U6_plot)

```

Overall, we see specific capture of U6, cyclic phosphate in all the samples. Although, there were disparities among the relatives amounts of cyclic phosphate captured between library samples. 

